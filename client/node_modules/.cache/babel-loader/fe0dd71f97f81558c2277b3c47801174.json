{"ast":null,"code":"import _regeneratorRuntime from\"/Users/balajikamalanathan/Documents/GitHub/react-node-stripe-payment/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/balajikamalanathan/Documents/GitHub/react-node-stripe-payment/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/balajikamalanathan/Documents/GitHub/react-node-stripe-payment/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState}from\"react\";import style from\"./PaymentForm.module.scss\";import{useHistory}from\"react-router-dom\";import clsx from\"clsx\";import{format}from\"date-fns\";import{useStripe,CardCvcElement,useElements}from\"@stripe/react-stripe-js\";import{postRequest}from\"../utils/api\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function PaymentForm(_ref){var paymentMethod=_ref.paymentMethod,paymentIntent=_ref.paymentIntent;var stripe=useStripe();var elements=useElements();var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),cvcError=_useState2[0],setCvcError=_useState2[1];var card=paymentMethod.card,billing_details=paymentMethod.billing_details;var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();stripe.createToken(\"cvc_update\",elements.getElement(CardCvcElement)).then(function(result){if(result.error){setCvcError(result.error.message);}else{postRequest(\"/payment/confirm\",{paymentMethod:paymentMethod.id,paymentIntent:paymentIntent.id}).then(function(resp){console.log(resp.data);handleServerResponse(resp.data);}).catch(function(err){console.log(err);});}}).catch(function(err){console.log(err);/* Handle error*/});case 2:case\"end\":return _context.stop();}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();function handleServerResponse(response){if(response.error){/* Handle Error */history.replace('/payment-failure');}else if(response.next_action){handleAction(response);}else{history.replace('/payment-success');/* Handle Success */}}function handleAction(response){stripe.handleCardAction(response.client_secret).then(function(result){if(result.error){console.log(result.error);/* Handle error */}else{postRequest(\"/payment/confirm\",{paymentIntent:paymentIntent.id,paymentMethod:paymentMethod.id}).then(function(resp){handleServerResponse(resp.data);}).catch(function(err){console.log(err);/* Handle Error */});}});}return card&&/*#__PURE__*/_jsx(\"div\",{className:style.wrapper,children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:style.card,children:[/*#__PURE__*/_jsx(\"div\",{className:style.icon,children:/*#__PURE__*/_jsx(\"img\",{src:card.icon,alt:\"\"})}),/*#__PURE__*/_jsxs(\"div\",{className:style.row,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Cardholder Name\"}),/*#__PURE__*/_jsx(\"p\",{children:billing_details.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:clsx(style.row,style.col),children:[/*#__PURE__*/_jsxs(\"div\",{className:style.cardNumber,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Card Number\"}),/*#__PURE__*/_jsx(\"p\",{children:\"**** **** **** \".concat(card.last4)})]}),/*#__PURE__*/_jsxs(\"div\",{className:style.expiry,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Card Expiry\"}),/*#__PURE__*/_jsx(\"p\",{children:format(new Date(\"\".concat(card.exp_year,\"/\").concat(card.exp_month,\"/01\")),\"mm/yyyy\")})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:style.row,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Enter Cvc/Cvv \"}),/*#__PURE__*/_jsx(\"div\",{className:style.cvcInput,children:/*#__PURE__*/_jsx(CardCvcElement,{onChange:function onChange(){setCvcError(null);}})}),/*#__PURE__*/_jsx(\"p\",{className:style.cvcError,children:cvcError})]})]}),/*#__PURE__*/_jsx(\"div\",{className:style.btnContainer,children:/*#__PURE__*/_jsx(\"button\",{className:style.btnContainer,children:\"Make Payment\"})})]})});}","map":{"version":3,"names":["useState","style","useHistory","clsx","format","useStripe","CardCvcElement","useElements","postRequest","jsx","_jsx","jsxs","_jsxs","PaymentForm","_ref","paymentMethod","paymentIntent","stripe","elements","history","_useState","_useState2","_slicedToArray","cvcError","setCvcError","card","billing_details","handleSubmit","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","wrap","_callee$","_context","prev","next","preventDefault","createToken","getElement","then","result","error","message","id","resp","console","log","data","handleServerResponse","catch","err","stop","_x","apply","arguments","response","replace","next_action","handleAction","handleCardAction","client_secret","className","wrapper","children","onSubmit","icon","src","alt","row","name","col","cardNumber","concat","last4","expiry","Date","exp_year","exp_month","cvcInput","onChange","btnContainer"],"sources":["/Users/balajikamalanathan/Documents/GitHub/react-node-stripe-payment/client/src/components/PaymentForm.js"],"sourcesContent":["import { useState } from \"react\";\nimport style from \"./PaymentForm.module.scss\";\nimport { useHistory } from \"react-router-dom\";\nimport clsx from \"clsx\";\nimport { format } from \"date-fns\";\nimport { useStripe, CardCvcElement, useElements } from \"@stripe/react-stripe-js\";\nimport { postRequest } from \"../utils/api\";\n\nexport default function PaymentForm({ paymentMethod, paymentIntent }) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const history = useHistory();\n\n  const [cvcError, setCvcError] = useState(null);\n\n  const { card, billing_details } = paymentMethod;\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    stripe\n      .createToken(\"cvc_update\", elements.getElement(CardCvcElement))\n      .then((result) => {\n        if (result.error) {\n          setCvcError(result.error.message);\n        } else {\n          postRequest(`/payment/confirm`, {\n            paymentMethod: paymentMethod.id,\n            paymentIntent: paymentIntent.id,\n          })\n            .then((resp) => {\n              console.log(resp.data);\n              handleServerResponse(resp.data);\n            })\n            .catch((err) => {\n              console.log(err);\n            });\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n        /* Handle error*/\n      });\n  };\n\n  function handleServerResponse(response) {\n    if (response.error) {\n      /* Handle Error */\n      history.replace('/payment-failure');\n    } else if (response.next_action) {\n      handleAction(response);\n    } else {\n      history.replace('/payment-success');\n      /* Handle Success */\n    }\n  }\n\n  function handleAction(response) {\n    stripe.handleCardAction(response.client_secret).then(function (result) {\n      if (result.error) {\n        console.log(result.error);\n        /* Handle error */\n      } else {\n        postRequest(`/payment/confirm`, {\n          paymentIntent: paymentIntent.id,\n          paymentMethod: paymentMethod.id,\n        })\n          .then((resp) => {\n            handleServerResponse(resp.data);\n          })\n          .catch((err) => {\n            console.log(err);\n            /* Handle Error */\n          });\n      }\n    });\n  }\n\n  return (\n    card && (\n      <div className={style.wrapper}>\n        <form onSubmit={handleSubmit}>\n          <div className={style.card}>\n            <div className={style.icon}>\n              <img src={card.icon} alt=\"\" />\n            </div>\n            <div className={style.row}>\n              <label>Cardholder Name</label>\n              <p>{billing_details.name}</p>\n            </div>\n            <div className={clsx(style.row, style.col)}>\n              <div className={style.cardNumber}>\n                <label>Card Number</label>\n                <p>{`**** **** **** ${card.last4}`}</p>\n              </div>\n              <div className={style.expiry}>\n                <label>Card Expiry</label>\n                <p>{format(new Date(`${card.exp_year}/${card.exp_month}/01`), \"mm/yyyy\")}</p>\n              </div>\n            </div>\n\n            <div className={style.row}>\n              <label>Enter Cvc/Cvv </label>\n              <div className={style.cvcInput}>\n                <CardCvcElement\n                  onChange={() => {\n                    setCvcError(null);\n                  }}\n                />\n              </div>\n              <p className={style.cvcError}>{cvcError}</p>\n            </div>\n          </div>\n\n          <div className={style.btnContainer}>\n                <button className={style.btnContainer}>Make Payment</button>\n              </div>\n        </form>\n      </div>\n    )\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}